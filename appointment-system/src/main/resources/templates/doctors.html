<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Doctors</title>
    <link rel="stylesheet" href="../static/css/styles.css" />
</head>
<body>
<div class="container">
    <h2>Doctors</h2>
    <input id="search" placeholder="Search by specialization (e.g., Cardio)"/>
    <button id="btnSearch">Search</button>
    <div id="list"></div>
</div>

<script>
    async function load(q = '') {
      const res = await fetch('/api/doctors/search?q=' + encodeURIComponent(q));
      const data = await res.json();
      const list = document.getElementById('list');
      list.innerHTML = '';
      data.forEach(d => {
        const div = document.createElement('div');
        div.innerHTML = `<h3>${d.name}</h3><p>${d.specialization || ''}</p><button onclick="book(${d.id})">Book</button>`;
        list.appendChild(div);
      });
    }
    document.getElementById('btnSearch').addEventListener('click', () => load(document.getElementById('search').value));
    load();

    function book(docId) {
      const token = localStorage.getItem('token');
      const patientId = localStorage.getItem('patientId');
      if (!token || !patientId) {
        alert('Please login first');
        location.href = '/login.html';
        return;
      }
      const when = prompt('Enter appointment date/time in ISO format. Example: 2025-10-20T10:30:00');
      if (!when) return;
      const body = {
        patientId: parseInt(patientId),
        doctorId: docId,
        appointmentTime: when,
        notes: ''
      };
      fetch('/api/appointments/book', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(body)
      }).then(async r => {
        const txt = await r.text();
        if (r.ok) alert('Booked');
        else alert('Error: ' + txt);
      });
    }
</script>
</body>
</html>
